<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arvind Raman">
<meta name="dcterms.date" content="2024-04-07">

<title>Arvind’s Portfolio - Programmatic Advertising Ecosystem</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background: #ef6A65;
      }
</style>
<!-- ... -->

<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css">



<meta property="og:title" content="Arvind’s Portfolio - Programmatic Advertising Ecosystem">
<meta property="og:description" content="A mixed bag of technical blogs covering System Design, Cloud Computing, Kubernetes, Machine Learning, Ad Tech, CpaaS and Video Technology">
<meta property="og:image" content="https://ramanarvind.github.io/blog/20240930/AdtechBlogImage.jpg">
<meta property="og:site_name" content="Arvind's Portfolio">
<meta property="og:locale" content="en_US">
<meta name="twitter:title" content="Arvind’s Portfolio - Programmatic Advertising Ecosystem">
<meta name="twitter:description" content="A mixed bag of technical blogs covering System Design, Cloud Computing, Kubernetes, Machine Learning, Ad Tech, CpaaS and Video Technology">
<meta name="twitter:image" content="https://ramanarvind.github.io/blog/20240930/AdtechBlogImage.jpg">
<meta name="twitter:creator" content="@ramanarvind">
<meta name="twitter:site" content="@ramanarvind">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Arvind’s Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog/index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:ramanarvind@gmail.com"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ramanarvind" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/ramanarvind" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Programmatic Advertising Ecosystem</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">AdTech</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Arvind Raman </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 7, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#players" id="toc-players" class="nav-link" data-scroll-target="#players">Players</a></li>
  <li><a href="#adtech-platform" id="toc-adtech-platform" class="nav-link" data-scroll-target="#adtech-platform">AdTech Platform</a>
  <ul class="collapse">
  <li><a href="#ad-network" id="toc-ad-network" class="nav-link" data-scroll-target="#ad-network">Ad Network</a></li>
  <li><a href="#ad-exchange" id="toc-ad-exchange" class="nav-link" data-scroll-target="#ad-exchange">Ad Exchange</a></li>
  <li><a href="#supply-side-platform-ssp" id="toc-supply-side-platform-ssp" class="nav-link" data-scroll-target="#supply-side-platform-ssp">Supply Side Platform (SSP)</a></li>
  <li><a href="#demand-side-platform-dsp" id="toc-demand-side-platform-dsp" class="nav-link" data-scroll-target="#demand-side-platform-dsp">Demand Side Platform (DSP)</a></li>
  </ul></li>
  <li><a href="#data-managament-platform-dmp" id="toc-data-managament-platform-dmp" class="nav-link" data-scroll-target="#data-managament-platform-dmp">Data Managament Platform (DMP)</a></li>
  <li><a href="#third-party-ad-server" id="toc-third-party-ad-server" class="nav-link" data-scroll-target="#third-party-ad-server">Third Party Ad Server</a></li>
  <li><a href="#first-party-ad-server" id="toc-first-party-ad-server" class="nav-link" data-scroll-target="#first-party-ad-server">First Party Ad Server</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Programmatic Advertising automates the process of buying and selling digital advertising space using business rules and data. The ecosystem of software and systems in place to automate this process is called AdTech. In this article I intend to go over the the building blocks of the AdTech ecosystem.</p>
</section>
<section id="players" class="level1">
<h1>Players</h1>
<p>Before we go any further, lets briefly talk about the key players in the ecosystem - Advertisers and Publishers. ## Advertisers &amp; Advertising Agency Advertisers are people who want to put their brands, products and services in front of people. These are the guys interested in buying the Ad space. Advertisers work with Advertising Agencies to create compelling Ads to catch their target audience’s attention. ## Publishers Publishers on the other hand are people producing content and hence are the suppliers of the Ad space. Ad space could be made available on websites, digital billboards or VAST streaming services</p>
<p>Before the advent of the Ad Tech platform, buying and selling of the Ad slots used to happen manually and 1-on-1. Once an advertiser and a publisher had a deal and Insertion Order (IO) would be created, allowing the advertisers Ad to be displayed on the publishers Ad space.</p>
<p>However with the exponential growth of digital media (Websites, Digital billboards, Connected TVs, Apps running on mobile devices etc…), the number of publishers an advertiser had to negotiate with grew to an extent that it was no longer possible for him to individually negotiate with each one of them. A programmatic solution to trade Ad spaces and render Ads was required and thus the AdTech platform was born.</p>
<p>An AdTech platform is run by 3rd party intermediary companies. They are neither advertisers nor publishers but tend to serve as a broker between them.</p>
</section>
<section id="adtech-platform" class="level1">
<h1>AdTech Platform</h1>
<p>The AdTech Platform has evolved over a period of time to what it is now. We will trace this evolution to get a better understanding of these different components and why they were introduced.</p>
<section id="ad-network" class="level2">
<h2 class="anchored" data-anchor-id="ad-network">Ad Network</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="AdTech-AdNetwork.jpg" class="img-fluid figure-img"></p>
<figcaption>Programmatic Advertising Ad Networks</figcaption>
</figure>
</div>
<p>As a first step, an Ad Network was introduced to serve as a broker between a group of advertisers and publishers. Ad Networks, were introduced to help publishers sell their inventory and for advertisers to scale their digital Ad campaigns across many sites without having to deal with each publisher directly. Ad Networks aggregate unsold inventory from several publishers and offers this to the advertisers on a CPM (Cost Per Million) basis.</p>
<p>Besides reducing the friction inherent in an advertiser - publisher transaction, an Ad network also enhanced the trust in the system. A trursted Ad network like Google, could server as a guarantor for the quality of a publisher’s Ad space inventory while at the same time safeguarding the advertiser’s interest by reducing Ad fraud. As an example, an Ad network ensured that an advertiser was charged only when their Ads were shown on the publishers property.</p>
<p>The success of the Ad Network model, attracted many players (like Google, Facebook, Yahoo, Seismic etc…) each introducing their own Ad Network. An Ad Network (like Google Display Network or GDN) is a collection of publishers who chose to partner with that particular Ad Network, allowing it to display Ads on their property.</p>
<p>As the number of Ad Networks grew, the original problem faced by the advertisers returned. Instead of dealing with multiple publishers, they now had to deal with multiple Ad Networks. An Ad Exhchange was introduced next to solve this problem.</p>
</section>
<section id="ad-exchange" class="level2">
<h2 class="anchored" data-anchor-id="ad-exchange">Ad Exchange</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="AdTech-AdExchange.jpg" class="img-fluid figure-img"></p>
<figcaption>Programmatic Advertising Ad Exchange</figcaption>
</figure>
</div>
<p>The Ad Exchange did to the Ad Networks, what the Ad Network did to the publishers. The Ad Exchange clubbed multiple Ad Networks together and allowed the advertisers to run their campaign across all publishers attached to all Ad Networks attached to the Ad Echange. Further they also allowed marquee publishers to directly sell their Ad space inventory on the exchange, bypassing the Ad Network. These publishers connect to the Ad exchange via an Ad Tech ecosystem component called the Supply Side Platform (SSP).</p>
<p>Similarly, on the demand side, the advertisers connect to the Ad exchange via yet another AdTech ecosystem component called the Demand Side Platform (DSP). The DSPs interoperate across multiple Ad exchanges and solves the advertisers problem of dealing with multiple parties. An advertiser therefore selects a DSP based on the flexibility and controls it offers to run an Ad campaign.</p>
</section>
<section id="supply-side-platform-ssp" class="level2">
<h2 class="anchored" data-anchor-id="supply-side-platform-ssp">Supply Side Platform (SSP)</h2>
<p>A Supply Side Platform (SSP) allows publishers to sell their inventory of Ad slots on multiple Ad Exchanges and Ad Networks and in some cases directly to the DSPs.</p>
</section>
<section id="demand-side-platform-dsp" class="level2">
<h2 class="anchored" data-anchor-id="demand-side-platform-dsp">Demand Side Platform (DSP)</h2>
<p>A Demand Side Platform (DSP) allows advertisers to buy Ad space by connecting to Ad Exchanges, where the available Ad spaces are traded. DSP is a key component of the real-time bidding process, which allows advertisers to buy Ad space on an impression by impression basis. To help improve targeting, DSPs often use data from Data Management Platform (DMP). DSPs can also buy Ad space by directly connecting to a SSP</p>
<p>At this stage the, the phrase programmatic advertising started becoming mainstream. The entire process of buying and selling Ad space was automated. The AdTech ecosystem however continued to evolve to improve the efficacy of the Ad campaign.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="AdTech.jpg" class="img-fluid figure-img"></p>
<figcaption>Programmatic Advertising</figcaption>
</figure>
</div>
</section>
</section>
<section id="data-managament-platform-dmp" class="level1">
<h1>Data Managament Platform (DMP)</h1>
<p>DMPs were introcued to collect user information (like cookie and device IDs) to help advertisers reach their target audience with greater accuracy. Advertisers configure the DSPs to connect with the DMPs to use the auxillary information as an input to decide which Ad slots to buy.</p>
</section>
<section id="third-party-ad-server" class="level1">
<h1>Third Party Ad Server</h1>
<p>Most advertisers would use an Ad server. It is often called the Third Party Ad Server and provides the following functionalities * Decides which Ads to show. * Serves these Ads when requested * Connects with Demand Side Platform (DSP) to buy the Ad space inventory * Collects metrics around impressions to report back to the advertiser</p>
</section>
<section id="first-party-ad-server" class="level1">
<h1>First Party Ad Server</h1>
<p>The publishers also have an Ad server. In this case it is called a First Party Ad Server and provides the following functionalities * Manages the inventory of available Ad slots * Displays Ads that are being sold directly to advertisers via direct campaigns * In the absence of a direcy campaign, it decides which Ad codes to choose and serve them the Ad slots</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ramanarvind\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="faux-block">
<i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 Arvind Raman
</div>
<div class="faux-block">
All content licensed under<br><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> Creative Commons CC BY 4.0</a>
</div>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<div class="faux-block">
Made with <i class="fa-brands fa-python" aria-label="python"></i> and <a href="https://quarto.org/">Quarto</a>
</div>
<div class="faux-block">
<a href="https://github.com/satvikraman/portfolio">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a>
</div>
</div>
  </div>
</footer>
<!-- ... -->

<div id="waline"></div>

<script type="module">

import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';



init({

    el: '#waline',

    serverURL: 'https://waline-lcyly1la2-arvind-ramans-projects.vercel.app/',

    lang: 'en',

    reaction: ['https://unpkg.com/@waline/emojis@1.1.0/tw/1f44d.png'],

    pageview: true,

});

</script>





</body></html>